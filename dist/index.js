(()=>{"use strict";var e={45:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Storer=void 0;var o=r(550);Object.defineProperty(t,"Storer",{enumerable:!0,get:function(){return o.Storer}})},550:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((o=o.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(6===i[0]&&s.label<n[1]){s.label=n[1],n=i;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(i);break}n[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Storer=void 0;var s=i(r(417)),a=i(r(960)),u=r(554),c=r(302),l=function(){function e(e){void 0===e&&(e=null),this._args=e}return e.prototype.process=function(e){switch(e.type){case"login":return this._login()}},e.prototype._login=function(){return o(this,void 0,void 0,(function(){var e,t,r,o,i,l;return n(this,(function(n){switch(n.label){case 0:e=this._args,t=e.email,r=e.password,o=s.default.createHash("md5").update(r).digest("hex"),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,u.StorerModel.findOne({email:t,password:o})];case 2:if(!(i=n.sent()))throw new a.default.NotFound(c.EFS.NOT_FOUND);return[2,i];case 3:return l=n.sent(),[2,c.errorHandling(l,c.EFS.GENERIC)];case 4:return[2]}}))}))},e}();t.Storer=l},302:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.errorHandling=t.EFS=void 0;var n=o(r(960)),i=r(217);Object.defineProperty(t,"EFS",{enumerable:!0,get:function(){return i.EFS}}),t.errorHandling=function(e,t){if(console.error(e),e instanceof n.default.HttpError)throw e;throw new n.default.InternalServerError(null!=t?t:e.message)}},217:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EFS=void 0;var o=r(370);Object.defineProperty(t,"EFS",{enumerable:!0,get:function(){return o.EFS}})},370:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.EFS=void 0,function(e){e.GENERIC="Something went wrong",e.NOT_FOUND="Invalid credentials"}(r||(r={})),t.EFS=r},554:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StorerModel=t.ProducerModel=void 0;var o=r(519);Object.defineProperty(t,"ProducerModel",{enumerable:!0,get:function(){return o.ProducerModel}});var n=r(919);Object.defineProperty(t,"StorerModel",{enumerable:!0,get:function(){return n.StorerModel}})},519:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProducerModel=void 0;var o=r(619),n=new o.Schema({country:{required:!0,type:String},email:{required:!0,type:String,unique:!0},name:{required:!0,type:String,unique:!0},password:{required:!0,type:String}},{timestamps:{createdAt:!1,updatedAt:!0}}),i=o.model("producers",n);t.ProducerModel=i},919:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StorerModel=void 0;var o=r(619),n=new o.Schema({email:{required:!0,type:String,unique:!0},name:{required:!0,type:String},password:{required:!0,type:String},warehouseIds:[o.Types.ObjectId]},{timestamps:{createdAt:!1,updatedAt:!0}}),i=o.model("storers",n);t.StorerModel=i},411:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Server=t.applyRoutes=void 0;var o=r(149);Object.defineProperty(t,"applyRoutes",{enumerable:!0,get:function(){return o.applyRoutes}});var n=r(122);Object.defineProperty(t,"Server",{enumerable:!0,get:function(){return n.Server}})},149:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.applyRoutes=void 0;var n=o(r(677)),i=o(r(960)),s=r(479),a=r(928),u=[s.Storer];t.applyRoutes=function(e){e.use("/",s.Home),e.use("/api/docs",n.default.serve,n.default.setup(a.docs)),u.forEach((function(t){return e.use("/api",t)})),e.use((function(e,t,r){r(new i.default.NotFound("This route does not exist"))})),e.use((function(e,t,r,o){a.response(!0,{result:e.message},r,e.status),o()}))}},122:function(e,t,r){var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},n=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(6===i[0]&&s.label<n[1]){s.label=n[1],n=i;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(i);break}n[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Server=void 0;var a=s(r(127)),u=s(r(619)),c=s(r(150)),l=r(149),p=new(function(){function e(){this._app=a.default(),this._config()}return e.prototype._config=function(){this._app.set("port",process.env.PORT||"1996"),this._app.use(c.default("dev")),this._app.use(a.default.json()),this._app.use(a.default.urlencoded({extended:!1})),this._app.use((function(e,t,r){t.header("Access-Control-Allow-Methods","GET, POST, PATCH, DELETE"),t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Headers","Authorization, Content-Type"),r()})),l.applyRoutes(this._app)},e.prototype._mongo=function(){return n(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this._connection=u.default.connection,e={keepAlive:!0,useCreateIndex:!0,useFindAndModify:!1,useNewUrlParser:!0,useUnifiedTopology:!0},this._connection.on("connected",(function(){console.log("Mongo connection established.")})),this._connection.on("reconnected",(function(){console.log("Mongo connection reestablished")})),this._connection.on("disconnected",(function(){console.log("Mongo connection disconnected"),console.log("Trying to reconnected to Mongo..."),setTimeout((function(){u.default.connect(process.env.MONGO_URI,o(o({},e),{connectTimeoutMS:3e3,socketTimeoutMS:3e3}))}),3e3)})),this._connection.on("close",(function(){console.log("Mongo connection closed")})),this._connection.on("error",(function(e){console.log("Mongo connection error:"),console.error(e)})),[4,u.default.connect(process.env.MONGO_URI,e)];case 1:return t.sent(),[2]}}))}))},e.prototype.start=function(){var e=this;this._app.listen(this._app.get("port"),(function(){console.log("Server running at port "+e._app.get("port"))}));try{this._mongo()}catch(e){console.error(e)}},e}());t.Server=p},333:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Home=void 0;var o=r(127),n=r(928),i=o.Router();t.Home=i,i.route("").get((function(e,t){n.response(!1,"Welcome to Ichiki's backend!",t,200)}))},479:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Storer=t.Home=void 0;var o=r(333);Object.defineProperty(t,"Home",{enumerable:!0,get:function(){return o.Home}});var n=r(727);Object.defineProperty(t,"Storer",{enumerable:!0,get:function(){return n.Storer}})},727:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((o=o.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(6===i[0]&&s.label<n[1]){s.label=n[1],n=i;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(i);break}n[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Storer=void 0;var i=r(127),s=r(928),a=r(45),u=r(79),c=i.Router();t.Storer=c,c.route("/storer/login").post((function(e,t,r){return o(void 0,void 0,void 0,(function(){var o,i,c;return n(this,(function(n){switch(n.label){case 0:o=e.body.args,n.label=1;case 1:return n.trys.push([1,4,,5]),[4,u.authUserSchema.validateAsync(o)];case 2:return n.sent(),[4,new a.Storer(o).process({type:"login"})];case 3:return i=n.sent(),s.response(!1,{result:i},t,200),[3,5];case 4:return(c=n.sent()).isJoi&&(c.status=422),r(c),[3,5];case 5:return[2]}}))}))}))},79:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.idSchema=t.authUserSchema=void 0;var n=o(r(320)),i=r(868);Object.defineProperty(t,"authUserSchema",{enumerable:!0,get:function(){return i.authUserSchema}});var s=n.default.string().required().length(24);t.idSchema=s},868:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.authUserSchema=void 0;var n=o(r(320)),i=n.default.object({email:n.default.string().required().email(),password:n.default.string().required()});t.authUserSchema=i},928:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.response=t.docs=void 0;var n=o(r(34));t.docs=n.default;var i=r(178);Object.defineProperty(t,"response",{enumerable:!0,get:function(){return i.response}})},178:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.response=void 0,t.response=function(e,t,r,o){r.status(o).send({error:e,message:t})}},34:e=>{e.exports=JSON.parse('{"openapi":"3.0.0","info":{"title":"Ichiki backend","description":"Documentation of Ichiki backend","contact":{"email":"acecom.soporte@gmail.com"},"license":{"name":"MIT","url":"https://opensource.org/licenses/MIT"},"version":"0.1.0"},"servers":[{"url":"https://ichiki-back.herokuapp.com/api/","description":"Ichiki dev API"},{"url":"http://localhost:1996/api","description":"Ichiki local API"}],"tags":[{"name":"storer","description":"Operations related to the storer."}],"paths":{"/storer/login":{"post":{"tags":["storer"],"summary":"Storer login","operationId":"storerLogin","requestBody":{"$ref":"#/components/requestBodies/DtoStorer"},"responses":{"200":{"description":"Storer","content":{"application/json":{"schema":{"$ref":"#/components/schemas/StorerLoginSuccess"}}}},"404":{"description":"Invalid credentials","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"422":{"description":"Invalid request format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}}}}}},"components":{"schemas":{"Storer":{"type":"object","properties":{"_id":{"type":"string"},"email":{"type":"string"},"password":{"type":"string","description":"Number of DNI, CE or others."},"name":{"type":"string"},"warehouseIds":{"type":"array","items":{"type":"string"},"default":[],"description":"Warehouses that where registered by the user"}}},"StorerLoginSuccess":{"type":"object","properties":{"error":{"type":"boolean","default":false},"message":{"type":"object","properties":{"result":{"$ref":"#/components/schemas/Storer"}}}}},"DefaultSuccess":{"type":"object","properties":{"error":{"type":"boolean","default":false},"message":{"type":"object","properties":{"result":{"type":"string"}}}}},"DefaultError":{"type":"object","properties":{"error":{"type":"boolean","default":true},"message":{"type":"object","properties":{"result":{"type":"string"}}}}}},"requestBodies":{"DtoStorer":{"description":"Storer email and password","content":{"application/json":{"schema":{"type":"object","properties":{"args":{"type":"object","properties":{"email":{"type":"string","description":"Storer id"},"password":{"type":"string","description":"Storer password"}}}}}}},"required":true}}}}')},417:e=>{e.exports=require("crypto")},127:e=>{e.exports=require("express")},960:e=>{e.exports=require("http-errors")},320:e=>{e.exports=require("joi")},619:e=>{e.exports=require("mongoose")},150:e=>{e.exports=require("morgan")},677:e=>{e.exports=require("swagger-ui-express")}},t={};(function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,r),i.exports})(411).Server.start()})();