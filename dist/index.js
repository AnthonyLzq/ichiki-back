(()=>{"use strict";var e={45:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Warehouse=t.Product=t.Producer=t.Storer=void 0;var n=r(550);Object.defineProperty(t,"Storer",{enumerable:!0,get:function(){return n.Storer}});var o=r(567);Object.defineProperty(t,"Producer",{enumerable:!0,get:function(){return o.Producer}});var s=r(6);Object.defineProperty(t,"Product",{enumerable:!0,get:function(){return s.Product}});var a=r(735);Object.defineProperty(t,"Warehouse",{enumerable:!0,get:function(){return a.Warehouse}})},567:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Producer=void 0;var a=s(r(417)),i=s(r(960)),c=r(554),u=r(302),d=function(){function e(e){void 0===e&&(e=null),this._args=e}return e.prototype.process=function(e){switch(e.type){case"signUp":return this._signUp();case"login":return this._login()}},e.prototype._signUp=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,s,d,p;return o(this,(function(o){switch(o.label){case 0:e=this._args,t=e.country,r=e.name,n=e.email,s=e.password,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,c.ProducerModel.findOne({email:n})];case 2:if(o.sent())throw new i.default.Conflict(u.GE.ALREADY_REGISTERED);return d=a.default.createHash("md5").update(s).digest("hex"),[4,new c.ProducerModel({country:t,email:n,name:r,password:d}).save()];case 3:return[2,o.sent()];case 4:return p=o.sent(),[2,u.errorHandling(p,u.GE.INTERNAL_SERVER_ERROR)];case 5:return[2]}}))}))},e.prototype._login=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,s,d;return o(this,(function(o){switch(o.label){case 0:e=this._args,t=e.email,r=e.password,o.label=1;case 1:return o.trys.push([1,3,,4]),n=a.default.createHash("md5").update(r).digest("hex"),[4,c.ProducerModel.findOne({email:t,password:n},"-__v -password -updatedAt")];case 2:if(!(s=o.sent()))throw new i.default.NotFound(u.GE.NOT_FOUND);return[2,s];case 3:return d=o.sent(),[2,u.errorHandling(d,u.GE.INTERNAL_SERVER_ERROR)];case 4:return[2]}}))}))},e}();t.Producer=d},6:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Product=void 0;var a=s(r(960)),i=r(554),c=r(302),u=function(){function e(e){void 0===e&&(e=null),this._args=e}return e.prototype.process=function(e){switch(e.type){case"addProduct":return this._addProduct();case"removeProduct":return this._removeProduct();case"updateStock":return this._updateStock();case"list":return this._list()}},e.prototype._addProduct=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,s,u,d,p;return o(this,(function(o){switch(o.label){case 0:e=this._args,t=e.description,r=e.image,n=e.name,s=e.price,u=e.producer,d=e.stock,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,i.ProductModel.findOne({name:n,producer:u})];case 2:if(o.sent())throw new a.default.Conflict(c.EFProducts.ALREADY_REGISTERED);return[4,new i.ProductModel({description:t,image:r,name:n,price:s,producer:u,stock:d}).save()];case 3:return[2,o.sent()];case 4:return p=o.sent(),[2,c.errorHandling(p,c.GE.INTERNAL_SERVER_ERROR)];case 5:return[2]}}))}))},e.prototype._removeProduct=function(){return n(this,void 0,void 0,(function(){var e,t;return o(this,(function(r){switch(r.label){case 0:e=this._args.id,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,i.ProductModel.findByIdAndDelete(e)];case 2:return r.sent(),[2,c.MFP.REMOVE_SUCCESS];case 3:return t=r.sent(),[2,c.errorHandling(t,c.GE.INTERNAL_SERVER_ERROR)];case 4:return[2]}}))}))},e.prototype._updateStock=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,s;return o(this,(function(o){switch(o.label){case 0:e=this._args,t=e.id,r=e.stock,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,i.ProductModel.findById(t)];case 2:if(!(n=o.sent()))throw new a.default.NotFound(c.EFProducts.NOT_FOUND);if(0===r)throw new a.default.BadRequest(c.EFProducts.NOTHING_TO_UPDATE);if(n.stock+r<0)throw new a.default.Conflict(c.EFProducts.NOT_ENOUGH);return[4,i.ProductModel.findByIdAndUpdate(t,{stock:n.stock+r})];case 3:return o.sent(),n.stock+r===0?[2,c.MFP.STOCK_UPDATE_SUCCESS_0]:[2,c.MFP.STOCK_UPDATE_SUCCESS];case 4:return s=o.sent(),[2,c.errorHandling(s,c.GE.INTERNAL_SERVER_ERROR)];case 5:return[2]}}))}))},e.prototype._list=function(){return n(this,void 0,void 0,(function(){var e,t;return o(this,(function(r){switch(r.label){case 0:e=this._args.producer,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,i.ProductModel.find({producer:e})];case 2:return[2,r.sent()];case 3:return t=r.sent(),[2,c.errorHandling(t,c.GE.INTERNAL_SERVER_ERROR)];case 4:return[2]}}))}))},e}();t.Product=u},550:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Storer=void 0;var a=s(r(417)),i=s(r(960)),c=r(554),u=r(302),d=function(){function e(e){void 0===e&&(e=null),this._args=e}return e.prototype.process=function(e){switch(e.type){case"login":return this._login();case"addWarehouse":return this._addWarehouse()}},e.prototype._login=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,s,d;return o(this,(function(o){switch(o.label){case 0:e=this._args,t=e.email,r=e.password,n=a.default.createHash("md5").update(r).digest("hex"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,c.StorerModel.findOne({email:t,password:n},"-__v -updatedAt -password")];case 2:if(!(s=o.sent()))throw new i.default.NotFound(u.GE.NOT_FOUND);return[2,s];case 3:return d=o.sent(),[2,u.errorHandling(d,u.GE.INTERNAL_SERVER_ERROR)];case 4:return[2]}}))}))},e.prototype._addWarehouse=function(){return n(this,void 0,void 0,(function(){var e,t,r,n;return o(this,(function(o){switch(o.label){case 0:e=this._args,t=e.id,r=e.warehouseIds,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,c.StorerModel.findByIdAndUpdate(t,{$push:{warehouseIds:r[0]}})];case 2:return o.sent(),[3,4];case 3:return n=o.sent(),[2,u.errorHandling(n,u.GE.INTERNAL_SERVER_ERROR)];case 4:return[2]}}))}))},e}();t.Storer=d},302:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.errorHandling=t.MFW=t.MFP=t.GE=t.EFW=t.EFProducts=t.EFP=t.EFS=void 0;var o=n(r(960)),s=r(217);Object.defineProperty(t,"EFS",{enumerable:!0,get:function(){return s.EFS}}),Object.defineProperty(t,"EFP",{enumerable:!0,get:function(){return s.EFP}}),Object.defineProperty(t,"EFProducts",{enumerable:!0,get:function(){return s.EFProducts}}),Object.defineProperty(t,"EFW",{enumerable:!0,get:function(){return s.EFW}}),Object.defineProperty(t,"GE",{enumerable:!0,get:function(){return s.GE}}),Object.defineProperty(t,"MFP",{enumerable:!0,get:function(){return s.MFP}}),Object.defineProperty(t,"MFW",{enumerable:!0,get:function(){return s.MFW}}),t.errorHandling=function(e,t){if(console.error(e),e instanceof o.default.HttpError)throw e;throw new o.default.InternalServerError(null!=t?t:e.message)}},217:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MFW=t.MFP=t.GE=t.EFW=t.EFProducts=t.EFP=t.EFS=void 0;var n=r(370);Object.defineProperty(t,"EFS",{enumerable:!0,get:function(){return n.EFS}});var o=r(117);Object.defineProperty(t,"EFP",{enumerable:!0,get:function(){return o.EFP}});var s=r(248);Object.defineProperty(t,"EFProducts",{enumerable:!0,get:function(){return s.EFP}}),Object.defineProperty(t,"MFP",{enumerable:!0,get:function(){return s.MFP}});var a,i=r(160);Object.defineProperty(t,"EFW",{enumerable:!0,get:function(){return i.EFW}}),Object.defineProperty(t,"MFW",{enumerable:!0,get:function(){return i.MFW}}),function(e){e.ALREADY_REGISTERED="That email is already registered",e.INTERNAL_SERVER_ERROR="Something went wrong",e.NOT_FOUND="Invalid credentials"}(a||(a={})),t.GE=a},117:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.EFP=void 0,r||(r={}),t.EFP=r},248:(e,t)=>{var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.MFP=t.EFP=void 0,function(e){e.ALREADY_REGISTERED="That product is already registered",e.NOTHING_TO_UPDATE="The value to update can not be 0",e.NOT_ENOUGH="Not enough stock. Do you want to delete the product?",e.NOT_FOUND="That product does not exists"}(r||(r={})),t.EFP=r,function(e){e.REMOVE_SUCCESS="The product was successfully removed",e.STOCK_UPDATE_SUCCESS="The stock was successfully updated",e.STOCK_UPDATE_SUCCESS_0="The stock was successfully updated, no stock left"}(n||(n={})),t.MFP=n},370:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.EFS=void 0,r||(r={}),t.EFS=r},160:(e,t)=>{var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.MFW=t.EFW=void 0,function(e){e.ALREADY_REGISTER="That warehouse is already registered",e.NO_PRODUCT_LEFT="The requested product does not have any stock",e.PRODUCT_NOT_ENOUGH="The requested product does not have enough stock",e.PRODUCT_NOT_FOUND="The requested product does not exists",e.STOCK_0="The stock to buy can not be 0",e.STOCK_NEGATIVE="The stock can not be negative",e.WAREHOUSE_NOT_FOUND="The requested warehouse does no exists"}(r||(r={})),t.EFW=r,function(e){e.REMOVE_SUCCESS="Warehouse successfully removed"}(n||(n={})),t.MFW=n},735:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,s=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return a},a=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,o=e.length;r<n;r++,o++)e[o]=t[r];return e},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Warehouse=void 0;var c=i(r(960)),u=r(554),d=r(302),p=r(550),l=r(6),f=function(){function e(e){void 0===e&&(e=null),this._args=e}return e.prototype.process=function(e){switch(e.type){case"addWarehouse":return this._addWarehouse();case"removeWarehouse":return this._removeWarehouse();case"list":return this._list();case"addProduct":return this._addProduct()}},e.prototype._addWarehouse=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,s,a,i;return o(this,(function(o){switch(o.label){case 0:e=this._args,t=e.address,r=e.country,n=e.name,s=e.owner,o.label=1;case 1:return o.trys.push([1,5,,6]),[4,u.WarehouseModel.findOne({name:n,owner:s})];case 2:if(o.sent())throw new c.default.Conflict(d.EFW.ALREADY_REGISTER);return[4,new u.WarehouseModel({address:t,country:r,name:n,owner:s}).save()];case 3:return a=o.sent(),[4,new p.Storer({id:s,warehouseIds:[a._id.toString()]}).process({type:"addWarehouse"})];case 4:return o.sent(),[2,a];case 5:return i=o.sent(),[2,d.errorHandling(i,d.GE.INTERNAL_SERVER_ERROR)];case 6:return[2]}}))}))},e.prototype._removeWarehouse=function(){return n(this,void 0,void 0,(function(){var e,t;return o(this,(function(r){switch(r.label){case 0:e=this._args.id,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,u.WarehouseModel.findByIdAndDelete(e)];case 2:return r.sent(),[2,d.MFW.REMOVE_SUCCESS];case 3:return t=r.sent(),[2,d.errorHandling(t,d.GE.INTERNAL_SERVER_ERROR)];case 4:return[2]}}))}))},e.prototype._list=function(){return n(this,void 0,void 0,(function(){var e,t;return o(this,(function(r){switch(r.label){case 0:e=this._args.owner,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,u.WarehouseModel.find({owner:e})];case 2:return[2,r.sent()];case 3:return t=r.sent(),[2,d.errorHandling(t,d.GE.INTERNAL_SERVER_ERROR)];case 4:return[2]}}))}))},e.prototype._addProduct=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,i,p,f,h,y,m,v;return o(this,(function(o){switch(o.label){case 0:e=this._args,t=e.id,r=e.pns,i=(n=r).product,p=n.stock,o.label=1;case 1:if(o.trys.push([1,9,,10]),p<0)throw new c.default.BadRequest(d.EFW.STOCK_NEGATIVE);if(0===p)throw new c.default.BadRequest(d.EFW.STOCK_0);return[4,u.ProductModel.findById(i)];case 2:if(!(f=o.sent()))throw new c.default.NotFound(d.EFW.PRODUCT_NOT_FOUND);if(0===f.stock)throw new c.default.Conflict(d.EFW.NO_PRODUCT_LEFT);if(p>f.stock)throw new c.default.Conflict(d.EFW.PRODUCT_NOT_ENOUGH);return[4,u.WarehouseModel.findById(t)];case 3:if(!(h=o.sent()))throw new c.default.NotFound(d.EFW.WAREHOUSE_NOT_FOUND);return y=h.pns,m=void 0,a([],s(new Set(y.map((function(e){return e.product.toString()}))))).includes(i)?[3,5]:[4,u.WarehouseModel.findByIdAndUpdate(t,{$push:{pns:{price:f.price,product:i,stock:p}}},{new:!0})];case 4:return m=o.sent(),[3,7];case 5:return y=y.map((function(e){return e.product.toString()===i&&(e.stock+=p),e})),[4,u.WarehouseModel.findByIdAndUpdate(t,{pns:y},{new:!0})];case 6:m=o.sent(),o.label=7;case 7:if(!m)throw new c.default.NotFound(d.EFW.WAREHOUSE_NOT_FOUND);return[4,new l.Product({id:i,stock:-p}).process({type:"updateStock"})];case 8:return o.sent(),[2,m];case 9:return v=o.sent(),[2,d.errorHandling(v,d.GE.INTERNAL_SERVER_ERROR)];case 10:return[2]}}))}))},e}();t.Warehouse=f},554:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WarehouseModel=t.ProductModel=t.StorerModel=t.ProducerModel=void 0;var n=r(519);Object.defineProperty(t,"ProducerModel",{enumerable:!0,get:function(){return n.ProducerModel}});var o=r(919);Object.defineProperty(t,"StorerModel",{enumerable:!0,get:function(){return o.StorerModel}});var s=r(365);Object.defineProperty(t,"ProductModel",{enumerable:!0,get:function(){return s.ProductModel}});var a=r(927);Object.defineProperty(t,"WarehouseModel",{enumerable:!0,get:function(){return a.WarehouseModel}})},519:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProducerModel=void 0;var n=r(619),o=new n.Schema({country:{required:!0,type:String},email:{required:!0,type:String,unique:!0},name:{required:!0,type:String},password:{required:!0,type:String}},{timestamps:{createdAt:!1,updatedAt:!0}}),s=n.model("producers",o);t.ProducerModel=s},365:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProductModel=void 0;var n=r(619),o=new n.Schema({description:{required:!0,type:String},image:Buffer,name:{required:!0,type:String},price:{required:!0,type:Number},producer:{ref:"producers",required:!0,type:n.Types.ObjectId},stock:{integer:!0,required:!0,type:Number,validate:{message:"{VALUE} is not integer value",validator:Number.isInteger}}},{timestamps:{createdAt:!1,updatedAt:!0}}),s=n.model("products",o);t.ProductModel=s},919:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StorerModel=void 0;var n=r(619),o=new n.Schema({email:{required:!0,type:String,unique:!0},name:{required:!0,type:String},password:{required:!0,type:String},warehouseIds:[{ref:"warehouses",type:n.Types.ObjectId}]},{timestamps:{createdAt:!1,updatedAt:!0}}),s=n.model("storers",o);t.StorerModel=s},927:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WarehouseModel=void 0;var n=r(619),o=new n.Schema({price:{required:!0,type:Number},product:{ref:"products",required:!0,type:n.Types.ObjectId},stock:{integer:!0,required:!0,type:Number}},{_id:!1,timestamps:{createdAt:!1,updatedAt:!0}}),s=new n.Schema({address:{required:!0,type:String},country:{required:!0,type:String},name:{required:!0,type:String,unique:!0},owner:{ref:"storers",required:!0,type:n.Types.ObjectId},pns:[o]},{timestamps:{createdAt:!1,updatedAt:!0}}),a=n.model("warehouses",s);t.WarehouseModel=a},411:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Server=t.applyRoutes=void 0;var n=r(149);Object.defineProperty(t,"applyRoutes",{enumerable:!0,get:function(){return n.applyRoutes}});var o=r(122);Object.defineProperty(t,"Server",{enumerable:!0,get:function(){return o.Server}})},149:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.applyRoutes=void 0;var o=n(r(677)),s=n(r(960)),a=r(479),i=r(928),c=[a.Storer,a.Producer,a.Product,a.Warehouse];t.applyRoutes=function(e){e.use("/",a.Home),e.use("/api/docs",o.default.serve,o.default.setup(i.docs)),c.forEach((function(t){return e.use("/api",t)})),e.use((function(e,t,r){r(new s.default.NotFound("This route does not exist"))})),e.use((function(e,t,r,n){i.response(!0,{result:e.message},r,e.status),n()}))}},122:function(e,t,r){var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Server=void 0;var i=a(r(127)),c=a(r(619)),u=a(r(150)),d=a(r(118)),p=r(149),l=new(function(){function e(){this._app=i.default(),this._config()}return e.prototype._config=function(){this._app.set("port",process.env.PORT||"1996"),this._app.use(u.default("dev")),this._app.use(i.default.json()),this._app.use(d.default()),this._app.use(i.default.urlencoded({extended:!1})),this._app.use((function(e,t,r){t.header("Access-Control-Allow-Methods","GET, POST, PATCH, DELETE"),t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Headers","Authorization, Content-Type"),r()})),p.applyRoutes(this._app)},e.prototype._mongo=function(){return o(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return this._connection=c.default.connection,e={keepAlive:!0,useCreateIndex:!0,useFindAndModify:!1,useNewUrlParser:!0,useUnifiedTopology:!0},this._connection.on("connected",(function(){console.log("Mongo connection established.")})),this._connection.on("reconnected",(function(){console.log("Mongo connection reestablished")})),this._connection.on("disconnected",(function(){console.log("Mongo connection disconnected"),console.log("Trying to reconnected to Mongo..."),setTimeout((function(){c.default.connect(process.env.MONGO_URI,n(n({},e),{connectTimeoutMS:3e3,socketTimeoutMS:3e3}))}),3e3)})),this._connection.on("close",(function(){console.log("Mongo connection closed")})),this._connection.on("error",(function(e){console.log("Mongo connection error:"),console.error(e)})),[4,c.default.connect(process.env.MONGO_URI,e)];case 1:return t.sent(),[2]}}))}))},e.prototype.start=function(){var e=this;this._app.listen(this._app.get("port"),(function(){console.log("Server running at port "+e._app.get("port"))}));try{this._mongo()}catch(e){console.error(e)}},e}());t.Server=l},333:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Home=void 0;var n=r(127),o=r(928),s=n.Router();t.Home=s,s.route("").get((function(e,t){o.response(!1,"Welcome to Ichiki's backend!",t,200)}))},479:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Warehouse=t.Product=t.Producer=t.Storer=t.Home=void 0;var n=r(333);Object.defineProperty(t,"Home",{enumerable:!0,get:function(){return n.Home}});var o=r(727);Object.defineProperty(t,"Storer",{enumerable:!0,get:function(){return o.Storer}});var s=r(60);Object.defineProperty(t,"Producer",{enumerable:!0,get:function(){return s.Producer}});var a=r(738);Object.defineProperty(t,"Product",{enumerable:!0,get:function(){return a.Product}});var i=r(475);Object.defineProperty(t,"Warehouse",{enumerable:!0,get:function(){return i.Warehouse}})},60:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Producer=void 0;var s=r(127),a=r(928),i=r(45),c=r(79),u=s.Router();t.Producer=u,u.route("/producer/signUp").post((function(e,t,r){return n(void 0,void 0,void 0,(function(){var n,s,u;return o(this,(function(o){switch(o.label){case 0:n=e.body.args,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,c.signUpProducer.validateAsync(n)];case 2:return o.sent(),[4,new i.Producer(n).process({type:"signUp"})];case 3:return s=o.sent(),a.response(!1,{result:{country:s.country,email:s.email,id:s._id,name:s.name}},t,200),[3,5];case 4:return(u=o.sent()).isJoi&&(u.status=422),r(u),[3,5];case 5:return[2]}}))}))})),u.route("/producer/login").post((function(e,t,r){return n(void 0,void 0,void 0,(function(){var n,s,u;return o(this,(function(o){switch(o.label){case 0:n=e.body.args,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,c.signIn.validateAsync(n)];case 2:return o.sent(),[4,new i.Producer(n).process({type:"login"})];case 3:return s=o.sent(),a.response(!1,{result:{country:s.country,email:s.email,id:s._id,name:s.name}},t,200),[3,5];case 4:return(u=o.sent()).isJoi&&(u.status=422),r(u),[3,5];case 5:return[2]}}))}))}))},738:function(e,t,r){var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Product=void 0;var i=r(127),c=a(r(960)),u=r(928),d=r(45),p=r(79),l=i.Router();t.Product=l,l.route("/product/addProductWithImage").post((function(e,t,r){return o(void 0,void 0,void 0,(function(){var o,a,i,l,f,h,y;return s(this,(function(s){switch(s.label){case 0:o=e.body.args,a=e.files,s.label=1;case 1:if(s.trys.push([1,4,,5]),!a)throw new c.default.BadRequest("Missing image");return i=JSON.parse(o),l=a.image,f=l.data,i=n(n({},i),{image:f}),[4,p.product.validateAsync(i)];case 2:return s.sent(),[4,new d.Product(i).process({type:"addProduct"})];case 3:return h=s.sent(),u.response(!1,{result:{description:h.description,id:h._id,image:h.image,name:h.name,price:h.price,producer:h.producer,stock:h.stock}},t,200),[3,5];case 4:return(y=s.sent()).message.includes("JSON")&&r(new c.default.BadRequest("Malformed product")),y.isJoi&&(y.status=422),r(y),[3,5];case 5:return[2]}}))}))})),l.route("/product/addProductWithoutImage").post((function(e,t,r){return o(void 0,void 0,void 0,(function(){var n,o,a;return s(this,(function(s){switch(s.label){case 0:n=e.body.args,s.label=1;case 1:return s.trys.push([1,4,,5]),[4,p.product.validateAsync(n)];case 2:return s.sent(),[4,new d.Product(n).process({type:"addProduct"})];case 3:return o=s.sent(),u.response(!1,{result:{description:o.description,id:o._id,name:o.name,price:o.price,producer:o.producer,stock:o.stock}},t,200),[3,5];case 4:return(a=s.sent()).isJoi&&(a.status=422),r(a),[3,5];case 5:return[2]}}))}))})),l.route("/product/removeProduct/:id").delete((function(e,t,r){return o(void 0,void 0,void 0,(function(){var n,o,a;return s(this,(function(s){switch(s.label){case 0:n=e.params.id,s.label=1;case 1:return s.trys.push([1,4,,5]),[4,p.idSchema.validateAsync(n)];case 2:return s.sent(),[4,new d.Product({id:n}).process({type:"removeProduct"})];case 3:return o=s.sent(),u.response(!1,{result:o},t,200),[3,5];case 4:return(a=s.sent()).isJoi&&(a.status=422),r(a),[3,5];case 5:return[2]}}))}))})),l.route("/product/updateStock").patch((function(e,t,r){return o(void 0,void 0,void 0,(function(){var n,o,a;return s(this,(function(s){switch(s.label){case 0:n=e.body.args,s.label=1;case 1:return s.trys.push([1,4,,5]),[4,p.updateStock.validateAsync(n)];case 2:return s.sent(),[4,new d.Product(n).process({type:"updateStock"})];case 3:return o=s.sent(),u.response(!1,{result:o},t,200),[3,5];case 4:return(a=s.sent()).isJoi&&(a.status=422),r(a),[3,5];case 5:return[2]}}))}))})),l.route("/product/list/:producer").get((function(e,t,r){return o(void 0,void 0,void 0,(function(){var n,o,a;return s(this,(function(s){switch(s.label){case 0:n=e.params.producer,s.label=1;case 1:return s.trys.push([1,4,,5]),[4,p.idSchema.validateAsync(n)];case 2:return s.sent(),[4,new d.Product({producer:n}).process({type:"list"})];case 3:return o=s.sent(),u.response(!1,{result:o.map((function(e){return{description:e.description,id:e._id,image:e.image||null,name:e.name,price:e.price,stock:e.stock}}))},t,200),[3,5];case 4:return(a=s.sent()).isJoi&&(a.status=422),r(a),[3,5];case 5:return[2]}}))}))}))},727:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Storer=void 0;var s=r(127),a=r(928),i=r(45),c=r(79),u=s.Router();t.Storer=u,u.route("/storer/login").post((function(e,t,r){return n(void 0,void 0,void 0,(function(){var n,s,u;return o(this,(function(o){switch(o.label){case 0:n=e.body.args,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,c.signIn.validateAsync(n)];case 2:return o.sent(),[4,new i.Storer(n).process({type:"login"})];case 3:return s=o.sent(),a.response(!1,{result:{email:s.email,id:s._id,name:s.name,warehouseIds:s.warehouseIds}},t,200),[3,5];case 4:return(u=o.sent()).isJoi&&(u.status=422),r(u),[3,5];case 5:return[2]}}))}))}))},475:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Warehouse=void 0;var s=r(127),a=r(928),i=r(45),c=r(79),u=s.Router();t.Warehouse=u,u.route("/warehouse/addWarehouse").post((function(e,t,r){return n(void 0,void 0,void 0,(function(){var n,s,u;return o(this,(function(o){switch(o.label){case 0:n=e.body.args,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,c.addWarehouse.validateAsync(n)];case 2:return o.sent(),[4,new i.Warehouse(n).process({type:"addWarehouse"})];case 3:return s=o.sent(),a.response(!1,{result:{address:s.address,country:s.country,id:s._id,name:s.name,owner:s.owner}},t,200),[3,5];case 4:return(u=o.sent()).isJoi&&(u.status=422),r(u),[3,5];case 5:return[2]}}))}))})),u.route("/warehouse/removeWarehouse/:id").delete((function(e,t,r){return n(void 0,void 0,void 0,(function(){var n,s,u;return o(this,(function(o){switch(o.label){case 0:n=e.params.id,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,c.idSchema.validateAsync(n)];case 2:return o.sent(),[4,new i.Warehouse({id:n}).process({type:"removeWarehouse"})];case 3:return s=o.sent(),a.response(!1,{result:s},t,200),[3,5];case 4:return(u=o.sent()).isJoi&&(u.status=422),r(u),[3,5];case 5:return[2]}}))}))})),u.route("/warehouse/list/:owner").get((function(e,t,r){return n(void 0,void 0,void 0,(function(){var n,s,u;return o(this,(function(o){switch(o.label){case 0:n=e.params.owner,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,c.idSchema.validateAsync(n)];case 2:return o.sent(),[4,new i.Warehouse({owner:n}).process({type:"list"})];case 3:return s=o.sent(),a.response(!1,{result:s.map((function(e){return{address:e.address,country:e.country,id:e._id,name:e.name,pns:e.pns}}))},t,200),[3,5];case 4:return(u=o.sent()).isJoi&&(u.status=422),r(u),[3,5];case 5:return[2]}}))}))})),u.route("/warehouse/addProduct").patch((function(e,t,r){return n(void 0,void 0,void 0,(function(){var n,s,u;return o(this,(function(o){switch(o.label){case 0:n=e.body.args,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,c.addProduct.validateAsync(n)];case 2:return o.sent(),[4,new i.Warehouse(n).process({type:"addProduct"})];case 3:return s=o.sent(),a.response(!1,{result:{address:s.address,country:s.country,id:s._id,name:s.name,pns:s.pns}},t,200),[3,5];case 4:return(u=o.sent()).isJoi&&(u.status=422),r(u),[3,5];case 5:return[2]}}))}))}))},79:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.idSchema=t.addProduct=t.addWarehouse=t.updateStock=t.product=t.signUpProducer=t.signIn=void 0;var o=n(r(320)),s=r(868);Object.defineProperty(t,"signIn",{enumerable:!0,get:function(){return s.signIn}}),Object.defineProperty(t,"signUpProducer",{enumerable:!0,get:function(){return s.signUpProducer}});var a=r(405);Object.defineProperty(t,"product",{enumerable:!0,get:function(){return a.product}}),Object.defineProperty(t,"updateStock",{enumerable:!0,get:function(){return a.updateStock}});var i=r(409);Object.defineProperty(t,"addWarehouse",{enumerable:!0,get:function(){return i.addWarehouse}}),Object.defineProperty(t,"addProduct",{enumerable:!0,get:function(){return i.addProduct}});var c=o.default.string().required().length(24);t.idSchema=c},405:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.updateStock=t.product=void 0;var o=n(r(320)),s=o.default.object().keys({description:o.default.string().required(),image:o.default.binary(),name:o.default.string().required(),price:o.default.number().required(),producer:o.default.string().length(24).required(),stock:o.default.number().integer().required()});t.product=s;var a=o.default.object().keys({id:o.default.string().length(24).required(),stock:o.default.number().integer().required()});t.updateStock=a},868:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.signUpProducer=t.signIn=void 0;var o=n(r(320)),s=o.default.object().keys({email:o.default.string().required().email(),password:o.default.string().required()});t.signIn=s;var a=s.keys({country:o.default.string().required(),name:o.default.string().required()});t.signUpProducer=a},409:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.addProduct=t.addWarehouse=void 0;var o=n(r(320)),s=o.default.object().keys({address:o.default.string().required(),country:o.default.string().required(),name:o.default.string().required(),owner:o.default.string().length(24).required()});t.addWarehouse=s;var a=o.default.object({product:o.default.string().length(24).required(),stock:o.default.number().integer().required()}).required(),i=o.default.object().keys({id:o.default.string().length(24).required(),pns:a});t.addProduct=i},928:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.response=t.docs=void 0;var o=n(r(34));t.docs=o.default;var s=r(178);Object.defineProperty(t,"response",{enumerable:!0,get:function(){return s.response}})},178:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.response=void 0,t.response=function(e,t,r,n){r.status(n).send({error:e,message:t})}},34:e=>{e.exports=JSON.parse('{"openapi":"3.0.0","info":{"title":"Ichiki backend","description":"Documentation of Ichiki backend","contact":{"email":"acecom.soporte@gmail.com"},"license":{"name":"MIT","url":"https://opensource.org/licenses/MIT"},"version":"0.6.0"},"servers":[{"url":"https://ichiki-back.herokuapp.com/api/","description":"Ichiki dev API"},{"url":"http://localhost:1996/api","description":"Ichiki local API"}],"tags":[{"name":"storer","description":"Operations related to the storer"},{"name":"producer","description":"Operations related to the producer"},{"name":"product","description":"Operations related to products"},{"name":"warehouse","description":"Operations related to warehouses"}],"paths":{"/storer/login":{"post":{"tags":["storer"],"summary":"Storer login","operationId":"storerLogin","requestBody":{"$ref":"#/components/requestBodies/DtoLogin"},"responses":{"200":{"description":"Storer successfully logged in","content":{"application/json":{"schema":{"$ref":"#/components/schemas/StorerLoginSuccess"}}}},"404":{"description":"Invalid credentials","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"422":{"description":"Invalid request format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}}}}},"/producer/signUp":{"post":{"tags":["producer"],"summary":"Producer sign up","operationId":"producerSignUp","requestBody":{"$ref":"#/components/requestBodies/DtoProducer"},"responses":{"200":{"description":"Producer successfully registered","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProducerSignUpSuccess"}}}},"422":{"description":"Invalid request format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}}}}},"/producer/login":{"post":{"tags":["producer"],"summary":"Producer login","operationId":"producerLogin","requestBody":{"$ref":"#/components/requestBodies/DtoLogin"},"responses":{"200":{"description":"Producer successfully logged in","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProducerLoginSuccess"}}}},"404":{"description":"Invalid credentials","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"422":{"description":"Invalid request format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}}}}},"/product/addProductWithoutImage":{"post":{"tags":["product"],"summary":"Let a producer add products","operationId":"addProductWithoutImage","requestBody":{"$ref":"#/components/requestBodies/DtoProduct"},"responses":{"200":{"description":"Product added","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AddProductWithoutImageSuccess"}}}},"409":{"description":"Product already registered for the producer","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"422":{"description":"Invalid request format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}}}}},"/product/addProductWithImage":{"post":{"tags":["product"],"summary":"Let a producer add products","operationId":"addProductWithImage","requestBody":{"content":{"multipart/form-data":{"schema":{"type":"object","properties":{"args":{"type":"string","description":"DtoProduct in a JSON parseable form","example":"{ \\"description\\": \\"This is a test\\", \\"name\\": \\"Test\\", \\"price\\": 19.99, \\"producer\\": \\"60e345d7861ccec771415378\\", \\"stock\\": 2 }"},"image":{"type":"string","format":"binary"}}}}}},"responses":{"200":{"description":"Product added","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AddProductWithImageSuccess"}}}},"400":{"description":"Missing image","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"409":{"description":"Product already registered for the producer","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"422":{"description":"Invalid request format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}}}}},"/product/removeProduct/{idProduct}":{"delete":{"tags":["product"],"summary":"Let a producer remove one product","operationId":"removeProduct","parameters":[{"name":"idProduct","in":"path","description":"MongoDB product id","required":true,"style":"simple","explode":false,"schema":{"type":"string"}}],"responses":{"200":{"description":"Product removed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultSuccess"}}}},"422":{"description":"Invalid request format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}}}}},"/product/updateStock":{"patch":{"tags":["product"],"summary":"Let a producer update the product stock","operationId":"updateStock","requestBody":{"description":"Product id and stock","content":{"application/json":{"schema":{"type":"object","properties":{"args":{"type":"object","properties":{"id":{"type":"string"},"stock":{"type":"integer","description":"Stock to update, the specified amount will be added or subtracted"}}}}}}},"required":true},"responses":{"200":{"description":"Product stock updated or product removed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultSuccess"}}}},"400":{"description":"Stock to update was 0","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"404":{"description":"Product not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"409":{"description":"Not enough stock","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"422":{"description":"Invalid request format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}}}}},"/product/list/{producer}":{"get":{"tags":["product"],"summary":"List the products from the producer","operationId":"listProducts","parameters":[{"name":"producer","in":"path","description":"MongoDB producer id","required":true,"style":"simple","explode":false,"schema":{"type":"string"}}],"responses":{"200":{"description":"Products from producer","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"boolean","default":false},"message":{"type":"object","properties":{"result":{"type":"array","items":{"$ref":"#/components/schemas/Product"}}}}}}}}},"422":{"description":"Invalid request format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}}}}},"/warehouse/addWarehouse":{"post":{"tags":["warehouse"],"summary":"Let a storer add a new warehouse","operationId":"addWarehouse","requestBody":{"$ref":"#/components/requestBodies/DtoWarehouse"},"responses":{"200":{"description":"Warehouse registered successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AddWarehouseSuccess"}}}},"409":{"description":"Warehouse already registered","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"422":{"description":"Invalid request format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}}}}},"/warehouse/removeWarehouse/{idWarehouse}":{"delete":{"tags":["warehouse"],"summary":"Let a storer remove a warehouse","operationId":"removeWarehouse","parameters":[{"name":"idWarehouse","in":"path","description":"MongoDB warehouse id","required":true,"style":"simple","explode":false,"schema":{"type":"string"}}],"responses":{"200":{"description":"Warehouse removed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultSuccess"}}}},"422":{"description":"Invalid request format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}}}}},"/warehouse/list/{owner}":{"get":{"tags":["warehouse"],"summary":"Let an owner list his warehouses","operationId":"listWarehouses","parameters":[{"name":"owner","in":"path","description":"MongoDB owner id","required":true,"style":"simple","explode":false,"schema":{"type":"string"}}],"responses":{"200":{"description":"Products from producer","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"boolean","default":false},"message":{"type":"object","properties":{"result":{"type":"array","items":{"$ref":"#/components/schemas/Warehouse"}}}}}}}}},"422":{"description":"Invalid request format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}}}}},"/warehouse/addProduct":{"patch":{"tags":["warehouse","product"],"summary":"Let a producer add a product to his warehouse","operationId":"addProductToWarehouse","requestBody":{"description":"Product id, warehouse id and stock","content":{"application/json":{"schema":{"type":"object","properties":{"args":{"type":"object","properties":{"id":{"type":"string","description":"MongoDB warehouse id"},"pns":{"type":"object","properties":{"product":{"type":"string","description":"MongoDB product id"},"stock":{"type":"string","description":"Quantity of items to buy"}}}}}}}}},"required":true},"responses":{"200":{"description":"Product stock updated or product removed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultSuccess"}}}},"400":{"description":"Stock to update was 0 or negative","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"404":{"description":"Product or warehouse not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"409":{"description":"Not enough stock","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"422":{"description":"Invalid request format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DefaultError"}}}}}}}},"components":{"schemas":{"Storer":{"type":"object","properties":{"id":{"type":"string"},"email":{"type":"string"},"name":{"type":"string"},"warehouseIds":{"type":"array","items":{"type":"string"},"default":[],"description":"Warehouses that where registered by the user"}}},"StorerLoginSuccess":{"type":"object","properties":{"error":{"type":"boolean","default":false},"message":{"type":"object","properties":{"result":{"$ref":"#/components/schemas/Storer"}}}}},"Producer":{"type":"object","properties":{"id":{"type":"string"},"country":{"type":"string"},"email":{"type":"string"},"name":{"type":"string"}}},"Product":{"type":"object","properties":{"description":{"type":"string"},"id":{"type":"string"},"image":{"type":"string","format":"binary"},"name":{"type":"string"},"price":{"type":"number"},"stock":{"type":"integer"}}},"Warehouse":{"type":"object","properties":{"address":{"type":"string"},"country":{"type":"string"},"id":{"type":"string"},"name":{"type":"string"},"pns":{"type":"array","items":{"$ref":"#/components/schemas/ProductAndStock"}}}},"ProductAndStock":{"type":"object","properties":{"product":{"type":"string"},"stock":{"type":"integer"},"price":{"type":"number"}}},"ProducerSignUpSuccess":{"type":"object","properties":{"error":{"type":"boolean","default":false},"message":{"type":"object","properties":{"result":{"$ref":"#/components/schemas/Producer"}}}}},"ProducerLoginSuccess":{"type":"object","properties":{"error":{"type":"boolean","default":false},"message":{"type":"object","properties":{"result":{"$ref":"#/components/schemas/Producer"}}}}},"AddProductWithImageSuccess":{"type":"object","properties":{"id":{"type":"string"},"description":{"type":"string"},"image":{"type":"string","format":"binary"},"name":{"type":"string"},"price":{"type":"number"},"producer":{"type":"string"},"stock":{"type":"integer"}}},"AddProductWithoutImageSuccess":{"type":"object","properties":{"id":{"type":"string"},"description":{"type":"string"},"name":{"type":"string"},"price":{"type":"number"},"producer":{"type":"string"},"stock":{"type":"integer"}}},"AddWarehouseSuccess":{"type":"object","properties":{"address":{"type":"string"},"country":{"type":"string"},"id":{"type":"string"},"name":{"type":"string"},"owner":{"type":"string"}}},"DefaultSuccess":{"type":"object","properties":{"error":{"type":"boolean","default":false},"message":{"type":"object","properties":{"result":{"type":"string"}}}}},"DefaultError":{"type":"object","properties":{"error":{"type":"boolean","default":true},"message":{"type":"object","properties":{"result":{"type":"string"}}}}}},"requestBodies":{"DtoLogin":{"description":"Storer or producer email and password","content":{"application/json":{"schema":{"type":"object","properties":{"args":{"type":"object","properties":{"email":{"type":"string"},"password":{"type":"string"}}}}}}},"required":true},"DtoStorer":{"description":"Storer dto","content":{"application/json":{"schema":{"type":"object","properties":{"args":{"type":"object","properties":{"email":{"type":"string"},"password":{"type":"string"},"name":{"type":"string"}}}}}}},"required":true},"DtoProducer":{"description":"Producer dto","content":{"application/json":{"schema":{"type":"object","properties":{"args":{"type":"object","properties":{"country":{"type":"string"},"email":{"type":"string"},"name":{"type":"string"},"password":{"type":"string"}}}}}}},"required":true},"DtoProduct":{"description":"Product dto","content":{"application/json":{"schema":{"type":"object","properties":{"args":{"type":"object","properties":{"description":{"type":"string"},"name":{"type":"string"},"price":{"type":"number"},"producer":{"type":"string"},"stock":{"type":"integer"}}}}}}},"required":true},"DtoWarehouse":{"description":"Warehouse dto","content":{"application/json":{"schema":{"type":"object","properties":{"args":{"type":"object","properties":{"name":{"type":"string"},"country":{"type":"string"},"address":{"type":"string"},"owner":{"type":"string","description":"MongoDB storer id"}}}}}}},"required":true}}}}')},417:e=>{e.exports=require("crypto")},127:e=>{e.exports=require("express")},118:e=>{e.exports=require("express-fileupload")},960:e=>{e.exports=require("http-errors")},320:e=>{e.exports=require("joi")},619:e=>{e.exports=require("mongoose")},150:e=>{e.exports=require("morgan")},677:e=>{e.exports=require("swagger-ui-express")}},t={};(function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports})(411).Server.start()})();